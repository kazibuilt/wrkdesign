{"version":3,"file":"WebGLObject-mExRcIUj.js","sources":["../../node_modules/@monogrid/vue-boost/dist/three/index5.mjs","../../src/functions/useGLTFToDOM.ts","../../src/components/atoms/WebGLObject.vue"],"sourcesContent":["/*!\n * @monogrid/vue-boost v8.2.0-develop.3 Copyright (C) MONOGRID S.R.L. - All Rights Reserved - Unauthorized copying of this file, via any medium is strictly prohibited\n */\nimport { getContainSize as E } from \"@monogrid/vue-boost/core\";\nimport { threeEnvironmentInjection as A, useDOMMapping as T, traverseAndDispose as V } from \"@monogrid/vue-boost/three\";\nimport { Object3D as j, BoxHelper as C, Box3 as F, Vector3 as H } from \"three\";\nimport { inject as I, shallowRef as x, ref as R, computed as m, toValue as v, watch as p, onUnmounted as U } from \"vue\";\nfunction k(w) {\n  const d = new F();\n  return d.setFromObject(w), {\n    boundingBox: d,\n    sizes: d.getSize(new H())\n  };\n}\nfunction L(w, d, a = {}) {\n  const o = I(A);\n  if (!o) throw new Error(\"[useDomMapping] A ThreeEnvironment is not provided\");\n  const O = T(w, a.domMappingOptions), i = x(new j()), n = x(), r = x(), h = R(), y = m(() => !!v(a.wrap)), z = m(() => !!v(a.debug)), f = m(() => y.value ? i.value : n.value), D = m(() => v(a.axis) || \"xy\"), B = m(() => v(a.order) || 0), s = (e) => {\n    e && (o.webgl.scene.remove(e), V(e, a.disposeOptions));\n  };\n  return p([() => v(d), y], ([e, t]) => {\n    n.value && s(n.value), i.value.children[0] && s(i.value.children[0]), h.value = void 0, e && (n.value = e, h.value = k(n.value), t ? (i.value.add(n.value), o.webgl.scene.add(i.value)) : o.webgl.scene.add(n.value));\n  }, { immediate: !0 }), p([f, B], ([e, t]) => {\n    e && (e.renderOrder = t);\n  }, { immediate: !0 }), p([f, z], ([e, t]) => {\n    r.value && s(r.value), !(!e || !t) && (r.value = new C(e, 65280), r.value.renderOrder = 999, o.webgl.scene.add(r.value));\n  }, { immediate: !0 }), p([f, O.position], ([e, { x: t, y: u, z: c }]) => {\n    var l;\n    e && (e.position.set(t, u, c), (l = r.value) == null || l.update());\n  }, { immediate: !0, flush: \"sync\" }), p([f, h, O.scale, D], ([e, t, u, c]) => {\n    var b;\n    if (!e || !t) return;\n    if (u.x === 0 || u.y === 0) {\n      e.scale.setScalar(0);\n      return;\n    }\n    const l = c.includes(\"y\") ? t.sizes.y : u.y;\n    let g = c.includes(\"x\") ? t.sizes.x : u.x;\n    c.includes(\"z\") && (g = Math.max(g, t.sizes.z));\n    const M = E(u.x, u.y, g, l, 1, 0.5, 0.5, !1);\n    e.scale.setScalar(Math.max(M.width / g, M.height / l)), (b = r.value) == null || b.update();\n  }, { immediate: !0, flush: \"sync\" }), U(() => {\n    s(n.value), s(i.value), s(r.value);\n  }), {\n    object: n,\n    debugObj: r,\n    domMapping: O\n  };\n}\nexport {\n  L as useDOMToObject3D\n};\n","import { useDOMToObject3D, UseDomToObject3DOptions } from '@monogrid/vue-boost/three'\nimport type { ComponentPublicInstance, MaybeRefOrGetter } from 'vue'\nimport { inject, shallowRef, toValue, watch } from 'vue'\n\nimport { lenisInjectionKey } from '@/App.vue'\nimport { gltfLoader } from '@/utils/gltfLoader'\n\nexport const useGLTFToDOM = (\n  el: MaybeRefOrGetter<HTMLElement | ComponentPublicInstance>,\n  url: MaybeRefOrGetter<string>,\n  domMappingOpts?: UseDomToObject3DOptions\n) => {\n  const lenis = inject(lenisInjectionKey)\n\n  const gltf = shallowRef()\n  const model = shallowRef()\n  const { object, domMapping } = useDOMToObject3D(el, model, domMappingOpts)\n\n  function onGltfLoaded (_gltf) {\n    model.value = _gltf.scene || _gltf.scenes[0]\n    gltf.value = _gltf\n  }\n\n  watch(() => toValue(url), (modelUrl) => {\n    if (!modelUrl) return\n    gltfLoader.load(modelUrl, onGltfLoaded, undefined, console.error)\n  }, { immediate: true })\n\n  watch(() => lenis.instance.value, _lenis => {\n    _lenis?.on('scroll', () => domMapping.update())\n  }, { immediate: true })\n\n  return {\n    domMapping,\n    gltf,\n    model,\n    object\n  }\n}\n","<script lang=\"ts\">\nimport { useSmoothNumber, useTicker } from '@monogrid/vue-boost/core'\nimport { templateRef } from '@vueuse/core'\nimport { AnimationMixer, MathUtils, Mesh, Object3D } from 'three'\nimport type { PropType } from 'vue'\nimport { defineComponent, inject, reactive, toValue, watch } from 'vue'\n\nimport { WEBGL_CONTENT_LAYER_Z } from '@/constants'\nimport { useGlobalReducedMotion } from '@/functions/useGlobalReducedMotion'\nimport { useGLTFToDOM } from '@/functions/useGLTFToDOM'\nimport { useSmoothPointer } from '@/functions/useSmoothPointer'\nimport type { MediaFile } from '@/graphql'\nimport { getMaterialObject } from '@/three/utils/materialLib.js'\nimport { threeEnvironmentInjection } from '@/three/WebGLApp.vue'\nexport default defineComponent({\n  name: 'WebGLObject',\n  props: {\n    data: { type: Object as PropType<Pick<MediaFile, 'id'>>, required: true },\n    wrap: { type: Boolean, default: false },\n    order: { type: Number, default: 2 },\n    angleX: { type: Number, default: 20 },\n    angleY: { type: Number, default: 10 },\n    breathY: { type: Number, default: 0 },\n    animationProgress: { type: Number, default: undefined }\n  },\n  setup (props, { attrs, slots, emit, expose }) {\n    const environment = inject(threeEnvironmentInjection)\n    if (!environment) throw new Error('[WebGLObject] A ThreeEnvironment is not provided')\n\n    const el = templateRef<HTMLElement>('el')\n\n    const tilt = reactive({ x: 0, y: 0 })\n    const rotation = reactive({ x: 0, y: 0, z: 0 })\n\n    const material = getMaterialObject()\n    const reducedMotion = useGlobalReducedMotion()\n    const { mappedX, mappedY } = useSmoothPointer()\n\n    let animations\n    let mixer\n\n    useSmoothNumber(mappedX, {\n      duration: 1,\n      ease: 'power3',\n      onUpdate: function () {\n        if (reducedMotion.value) return\n        if (object.value) {\n          tilt.y = this.targets()[0].value * MathUtils.degToRad(props.angleX)\n        }\n      }\n    })\n\n    useSmoothNumber(mappedY, {\n      duration: 1,\n      ease: 'power3',\n      onUpdate: function () {\n        if (reducedMotion.value) return\n        if (object.value) {\n          tilt.x = this.targets()[0].value * MathUtils.degToRad(props.angleY)\n        }\n      }\n    })\n\n    const { gltf, model, object, domMapping } = useGLTFToDOM(el,\n      () => props.data ? `/media/${props.data?.id}` : undefined,\n      {\n        order: () => props.order,\n        wrap: () => props.wrap,\n        domMappingOptions: {\n          boundingOptions: {\n            intersectionOptions: { rootMargin: '40px 0px' },\n            listenScroll: false\n          },\n          z: WEBGL_CONTENT_LAYER_Z.MODEL\n        }\n      })\n\n    function onTick ({ time }) {\n      if (!object.value) return\n\n      object.value.rotation.x = rotation.x + tilt.x\n      object.value.rotation.y = rotation.y + tilt.y\n      object.value.rotation.z = rotation.z\n      !reducedMotion.value && (domMapping.transform.translate.y = Math.sin(time * 0.75) * props.breathY)\n      material.uniforms.uPosY.value = window.scrollY / window.innerHeight\n\n      if (typeof props.animationProgress === 'number' && animations?.length) {\n        animations.forEach(animation => {\n          animation[0].time = animation[1].duration * props.animationProgress\n          animation[0].play()\n        })\n        mixer.update(0)\n      }\n    }\n\n    const { toggle } = useTicker(onTick)\n\n    watch(domMapping.visible, visible => toggle(visible), { immediate: true })\n\n    watch([gltf, model], ([_gltf, _model]) => {\n      if (!_model) return\n      _model.traverse((obj: Object3D | Mesh) => {\n        if (!('isMesh' in obj)) return\n        if (Array.isArray(obj.material)) obj.material.forEach((_, i) => (obj.material[i] = material))\n        else obj.material = material\n      })\n\n      if (_gltf.animations?.length < 1) return\n      mixer = new AnimationMixer(_model)\n      animations = _gltf.animations.map(clip => {\n        const animation = mixer.clipAction(clip)\n        animation.clampWhenFinished = true\n        return [animation, clip]\n      })\n    })\n\n    watch([\n      () => toValue(environment.width),\n      () => toValue(environment.height),\n      () => environment.webgl.renderer,\n      object\n    ], ([w, h, renderer, obj]) => {\n      if (!renderer || !obj) return\n      const dpr = renderer.getPixelRatio() || 1\n      material.uniforms.uResolution.value.set(w * dpr, h * dpr)\n    }, { immediate: true })\n\n    expose({\n      object,\n      rotation,\n      domMapping\n    })\n  }\n})\n</script>\n\n<template>\n  <div ref=\"el\" class=\"pointer-events-none\" />\n</template>\n"],"names":["k","w","d","F","H","L","a","o","I","A","O","T","i","x","j","n","r","h","R","y","m","v","f","D","B","s","V","p","t","C","u","c","l","b","g","M","E","U","useGLTFToDOM","el","url","domMappingOpts","lenis","inject","lenisInjectionKey","gltf","shallowRef","model","object","domMapping","useDOMToObject3D","onGltfLoaded","_gltf","watch","toValue","modelUrl","gltfLoader","_lenis","_sfc_main","defineComponent","props","attrs","slots","emit","expose","environment","threeEnvironmentInjection","templateRef","tilt","reactive","rotation","material","getMaterialObject","reducedMotion","useGlobalReducedMotion","mappedX","mappedY","useSmoothPointer","animations","mixer","useSmoothNumber","MathUtils","_a","WEBGL_CONTENT_LAYER_Z","onTick","time","animation","toggle","useTicker","visible","_model","obj","_","AnimationMixer","clip","renderer","dpr","_hoisted_1"],"mappings":"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","x_google_ignoreList":[0]}